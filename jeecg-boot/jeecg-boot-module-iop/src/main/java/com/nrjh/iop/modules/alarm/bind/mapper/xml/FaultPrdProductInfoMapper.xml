<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nrjh.iop.modules.alarm.bind.mapper.FaultPrdProductInfoMapper">
    <select id="pageAlarmByFaultTypeAndId" resultType="com.nrjh.iop.modules.alarm.bind.vo.FaultPrdProductInfoVO">
        SELECT t.id task_id,t.system_name,t.fault_type,t.fault_name,t.line_team,t.fault_labe,t.is_status,p.*
        FROM fault_task_info t
        LEFT JOIN fault_prd_product_info p ON t.id = p.FAULT_TASK_ID AND p.PRODUCT_ID = #{productId}
        WHERE t.fault_type = #{faultType}
        AND t.is_del = 0
        <if test="isStatus!=null">
            AND t.is_status = #{isStatus}
        </if>
    </select>


    <select id="queryFaultPrdProduct" resultType="com.nrjh.iop.modules.alarm.bind.vo.FaultPrdProductInfoVO" parameterType="com.nrjh.iop.modules.alarm.bind.vo.FaultPrdProductInfoVO">
        SELECT f.*
        FROM fault_prd_product_info  f
        WHERE 1=1 AND
        f.is_del = 0
        and f.fault_grade is not null
        <if test="productId!=null">
            AND f.product_Id = #{productId}
        </if>
        <if test="lineNo!=null">
            AND f.line_no = #{lineNo}
        </if>
        <if test="faultName != null">
            AND f.fault_name = #{faultName}
        </if>
    </select>

    <select id="queryExplanInfo" resultType="java.lang.String"  parameterType="java.lang.String" >
        SELECT  IOP_AREA_ID   FROM LINE_EXPLAIN_INFO line where (line.IOP_AREA_ID =#{lineNo} or line.LINE_EXPLAIN_ID =#{lineNo} )and rownum=1
    </select>


    <select id="pageAlarmByLineNoAndId" resultType="com.nrjh.iop.modules.alarm.bind.vo.FaultPrdProductInfoVO">
        SELECT t.id task_id,t.fault_type,t.fault_name,t.line_team,t.fault_labe,t.is_status,p.*
        FROM fault_task_info t
        LEFT JOIN fault_prd_product_info p ON t.id = p.FAULT_TASK_ID AND p.PRODUCT_ID = #{productId}
        <where>
            t.is_del = 0 AND p.is_del = 0
            <if test="faultName != null and faultName != ''">
                AND p.fault_name = #{faultName}
            </if>
            <if test="lineNo != null and lineNo != ''">
                AND p.line_no = #{lineNo}
            </if>
        </where>
    </select>
</mapper>
